# cluster-setup-template.jinja
#
# Copyright (C) 2013-2015, Levyx, Inc.
#
#  NOTICE:  All information contained herein is, and remains the property of
#  Levyx, Inc.  The intellectual and technical concepts contained herein are
#  proprietary to Levyx, Inc. and may be covered by U.S. and Foreign Patents,
#  patents in process, and are protected by trade secret or copyright law.
#  Dissemination of this information or reproduction of this material is
#  strictly forbidden unless prior written permission is obtained from Levyx,
#  Inc.  Access to the source code contained herein is hereby forbidden to
#  anyone except current Levyx, Inc. employees, managers or contractors who
#  have executed Confidentiality and Non-disclosure agreements explicitly
#  covering such access.
#

{% set image = properties["instanceImage"] %}
{% set zone = properties["instanceZone"] %}
{% set bootDiskType = properties["instanceBootDiskType"] %}
{% set machineType = properties["instanceMachineType"] %}
{% set numSSDs = properties["instanceNumSSDs"] %}
{% set projectName = properties["projectName"] %}
{% set numSlaves = properties["numSlaves"] %}
{% set startupScript = properties["startupScript"] %}

resources:
- name: {{ env["name"] }}-master
  type: templates/cluster-instance-template.jinja
  properties:
    instanceImage: {{image}}
    instanceNetwork: {{ env["name"] }}-network
    instanceMachineType: {{machineType}}
    instanceNumSSDs: {{numSSDs}}
    instanceZone: {{zone}}
    instanceBootDiskType: {{bootDiskType}}
    startupScript: {{startupScript}}

{% for i in range( numSlaves ) %}
- name: {{ env["name"] }}-slave-{{i}}
  type: templates/cluster-instance-template.jinja
  properties:
    instanceImage: {{image}}
    instanceNetwork: {{ env["name"] }}-network
    instanceMachineType: {{machineType}}
    instanceNumSSDs: {{numSSDs}}
    instanceZone: {{zone}}
    instanceBootDiskType: {{bootDiskType}}
    startupScript: {{startupScript}}
{% endfor %}
- name: {{ env["name"] }}-network
  type: templates/cluster-network-template.jinja
- name: {{ env["name"] }}-firewall
  type: templates/cluster-firewall-template.jinja
  properties:
    instanceNetwork: {{ env["name"] }}-network
