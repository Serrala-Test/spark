
# Levyx deploy test cluster

### How to use deploy
`deploy` is a shell script that can be invoked to create instances
on Google Cloud Platform (GCP). deploy assumes that:
1. You already have an account on GCP `shared-cluster-0` project
2. You have setup `gcloud` on your computer
3. Current version is limited to Levyx internal use only
4. GCP zone is set to `us-central-1c`

If you use `deploy` you need not know about the rest of the
scripts in this dir.

### How to use gen-deploy-config.py
1. Make sure gcloud command line tool is set to the right project  
   Use ```gcloud config list``` to see the project and user  
   Use ```gcloud config set project <project-name>``` to set the project
2. Make sure the project has the ```levyx-spark-dev-img``` image, it must also
   be named exactly as shown.
3. Change directory to the directory with these files.
4. Use:
   ```
   python gen-deploy-config.py [arguments]
   ```
   All arguments are optional. Type python make-deployment.py -h for help,
   or just look at the top of make-deployment.py
5. Use:
   ```
   gcloud deployment-manager deployments create levyx-test-deploy --config cluster-config.yaml
   ```
6. Wait for the success message and go to the gcloud console to see the deployment.  
   The VM will show up in the VM list as well as under "Deploy & Manage > Deployments"  
   When deleting deployments, delete with
   ```
   gcloud deployment-manager deployments delete levyx-test-deploy
   ```

### Something not working?
Check ```cluster-config-reference``` for an example yaml file that should look
like the yaml file generated by the ```gen-deploy-config.py.```  
```cluster-config-reference``` is NEVER USED BY ANYTHING. It's just for reference.

Make sure the startup .sh file only has SINGLE quotes ( ' ) NOT double quotes ( " ).
The python script needs to read the .sh file as a string, and thus secretly wraps your
text in double quotes. Having a double quote inside the .sh file will confuse
the script.
