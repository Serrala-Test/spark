#!/usr/bin/env bash

#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

SCALA_VERSION=2.10

FWDIR="$(cd `dirname $0`/..; pwd)"
export SPARK_HOME="$FWDIR"

. $FWDIR/bin/load-spark-env.sh
. $FWDIR/bin/sh-funcs.sh

# Figure out the JAR file that our examples were packaged into. This includes a bit of a hack
# to avoid the -sources and -doc packages that are built by publish-local.
EXAMPLES_DIR="$FWDIR"/examples

if [[ -z $SPARK_EXAMPLES_JAR ]]; then
  if [ -f "$FWDIR/RELEASE" ]; then
    one_glob "$FWDIR/lib/spark-examples-*hadoop*.jar"
    export SPARK_EXAMPLES_JAR=$_RET
  fi
  if [[ -z $SPARK_EXAMPLES_JAR ]]; then
    jars_pat="$EXAMPLES_DIR/target/scala-$SCALA_VERSION/spark-examples-*hadoop*.jar"
    errmsg="You need to build Spark before running this program"
    need_one_glob "$jars_pat" "$errmsg"
    export SPARK_EXAMPLES_JAR=$_RET
  fi
fi

EXAMPLE_MASTER=${MASTER:-"local[*]"}

if [ -n "$1" ]; then
  EXAMPLE_CLASS="$1"
  shift
else 
  echo "usage: ./bin/run-example <example-class> [example-args]" 
  echo "  - set MASTER=XX to use a specific master"
  echo "  - can use abbreviated example class name (e.g. SparkPi, mllib.MovieLensALS)"
  echo
  exit -1
fi

if [[ ! $EXAMPLE_CLASS == org.apache.spark.examples* ]]; then
  EXAMPLE_CLASS="org.apache.spark.examples.$EXAMPLE_CLASS"
fi

./bin/spark-submit \
  --master $EXAMPLE_MASTER \
  --class $EXAMPLE_CLASS \
  $SPARK_EXAMPLES_JAR \
  "$@"
