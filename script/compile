#!/usr/bin/env bash

set -x
set -e

FWDIR="$(cd `dirname $0`/..; pwd)"
# Compile spark jars into dist folder
export LOCAL_SBT_DIR=1
./make-distribution.sh --tgz --hadoop $(cat SHOPIFY_HADOOP_VERSION)
if [ "$?" != "0" || -e "$FWDIR/lib/spark-assembly*hadoop*.jar" ]; then
  echo "Failed to make spark distro using sbt."
  exit 1
fi
# Remove everything not in dist
find * -maxdepth 0 -name 'dist' -prune -o -exec rm -rf '{}' ';'
# Copy everything out of dist
mv dist/* .
