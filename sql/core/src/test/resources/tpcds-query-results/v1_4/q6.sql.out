-- Automatically generated by TPCDSQueryTestSuite

-- !query
SELECT
  a.ca_state state,
  count(*) cnt
FROM
  customer_address a, customer c, store_sales s, date_dim d, item i
WHERE a.ca_address_sk = c.c_current_addr_sk
  AND c.c_customer_sk = s.ss_customer_sk
  AND s.ss_sold_date_sk = d.d_date_sk
  AND s.ss_item_sk = i.i_item_sk
  AND d.d_month_seq =
  (SELECT DISTINCT (d_month_seq)
  FROM date_dim
  WHERE d_year = 2000 AND d_moy = 1)
  AND i.i_current_price > 1.2 *
  (SELECT avg(j.i_current_price)
  FROM item j
  WHERE j.i_category = i.i_category)
GROUP BY a.ca_state
HAVING count(*) >= 10
ORDER BY cnt
LIMIT 100
-- !query schema
struct<state:string,cnt:bigint>
-- !query output
AK	10
AL	63
AR	58
AZ	11
CA	84
CO	57
FL	51
GA	168
IA	102
ID	39
IL	95
IN	103
KS	139
KY	104
LA	63
MA	10
MD	22
ME	13
MI	82
MN	85
MO	88
MS	83
MT	53
NC	82
ND	38
NE	113
NH	16
NJ	21
NM	26
NULL	81
NV	15
NY	58
OH	114
OK	53
OR	31
PA	62
SC	45
SD	70
TN	102
TX	216
UT	17
VA	130
VT	14
WA	36
WI	80
WV	50
WY	25
