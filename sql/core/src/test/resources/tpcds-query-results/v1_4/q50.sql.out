-- Automatically generated by TPCDSQueryTestSuite

-- !query
SELECT
  s_store_name,
  s_company_id,
  s_street_number,
  s_street_name,
  s_street_type,
  s_suite_number,
  s_city,
  s_county,
  s_state,
  s_zip,
  sum(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk <= 30)
    THEN 1
      ELSE 0 END)  AS `30 days `,
  sum(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 30) AND
    (sr_returned_date_sk - ss_sold_date_sk <= 60)
    THEN 1
      ELSE 0 END)  AS `31 - 60 days `,
  sum(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 60) AND
    (sr_returned_date_sk - ss_sold_date_sk <= 90)
    THEN 1
      ELSE 0 END)  AS `61 - 90 days `,
  sum(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 90) AND
    (sr_returned_date_sk - ss_sold_date_sk <= 120)
    THEN 1
      ELSE 0 END)  AS `91 - 120 days `,
  sum(CASE WHEN (sr_returned_date_sk - ss_sold_date_sk > 120)
    THEN 1
      ELSE 0 END)  AS `>120 days `
FROM
  store_sales, store_returns, store, date_dim d1, date_dim d2
WHERE
  d2.d_year = 2001
    AND d2.d_moy = 8
    AND ss_ticket_number = sr_ticket_number
    AND ss_item_sk = sr_item_sk
    AND ss_sold_date_sk = d1.d_date_sk
    AND sr_returned_date_sk = d2.d_date_sk
    AND ss_customer_sk = sr_customer_sk
    AND ss_store_sk = s_store_sk
GROUP BY
  s_store_name, s_company_id, s_street_number, s_street_name, s_street_type,
  s_suite_number, s_city, s_county, s_state, s_zip
ORDER BY
  s_store_name, s_company_id, s_street_number, s_street_name, s_street_type,
  s_suite_number, s_city, s_county, s_state, s_zip
LIMIT 100
-- !query schema
struct<s_store_name:string,s_company_id:int,s_street_number:string,s_street_name:string,s_street_type:string,s_suite_number:string,s_city:string,s_county:string,s_state:string,s_zip:string,30 days :bigint,31 - 60 days :bigint,61 - 90 days :bigint,91 - 120 days :bigint,>120 days :bigint>
-- !query output
able                                              	1	255       	Sycamore                                                    	Dr.            	Suite 410 	Midway                                                      	Williamson County             	TN	31904     	67	48	61	66	98
ation                                             	1	811       	Lee                                                         	Circle         	Suite T   	Midway                                                      	Williamson County             	TN	31904     	70	51	50	61	109
bar                                               	1	175       	4th                                                         	Court          	Suite C   	Midway                                                      	Williamson County             	TN	31904     	96	53	55	76	86
eing                                              	1	226       	12th                                                        	Lane           	Suite D   	Fairview                                                    	Williamson County             	TN	35709     	69	63	62	63	114
ese                                               	1	27        	Lake                                                        	Ln             	Suite 260 	Midway                                                      	Williamson County             	TN	31904     	58	57	55	54	106
ought                                             	1	767       	Spring                                                      	Wy             	Suite 250 	Midway                                                      	Williamson County             	TN	31904     	81	63	52	58	103
