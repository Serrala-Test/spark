-- Automatically generated by TPCDSQueryTestSuite

-- !query
WITH ss AS (
  SELECT
    i_manufact_id,
    sum(ss_ext_sales_price) total_sales
  FROM
    store_sales, date_dim, customer_address, item
  WHERE
    i_manufact_id IN (SELECT i_manufact_id
    FROM item
    WHERE i_category IN ('Electronics'))
      AND ss_item_sk = i_item_sk
      AND ss_sold_date_sk = d_date_sk
      AND d_year = 1998
      AND d_moy = 5
      AND ss_addr_sk = ca_address_sk
      AND ca_gmt_offset = -5
  GROUP BY i_manufact_id), cs AS
(SELECT
    i_manufact_id,
    sum(cs_ext_sales_price) total_sales
  FROM catalog_sales, date_dim, customer_address, item
  WHERE
    i_manufact_id IN (
      SELECT i_manufact_id
      FROM item
      WHERE
        i_category IN ('Electronics'))
      AND cs_item_sk = i_item_sk
      AND cs_sold_date_sk = d_date_sk
      AND d_year = 1998
      AND d_moy = 5
      AND cs_bill_addr_sk = ca_address_sk
      AND ca_gmt_offset = -5
  GROUP BY i_manufact_id),
    ws AS (
    SELECT
      i_manufact_id,
      sum(ws_ext_sales_price) total_sales
    FROM
      web_sales, date_dim, customer_address, item
    WHERE
      i_manufact_id IN (SELECT i_manufact_id
      FROM item
      WHERE i_category IN ('Electronics'))
        AND ws_item_sk = i_item_sk
        AND ws_sold_date_sk = d_date_sk
        AND d_year = 1998
        AND d_moy = 5
        AND ws_bill_addr_sk = ca_address_sk
        AND ca_gmt_offset = -5
    GROUP BY i_manufact_id)
SELECT
  i_manufact_id,
  sum(total_sales) total_sales
FROM (SELECT *
      FROM ss
      UNION ALL
      SELECT *
      FROM cs
      UNION ALL
      SELECT *
      FROM ws) tmp1
GROUP BY i_manufact_id
ORDER BY total_sales
LIMIT 100
-- !query schema
struct<i_manufact_id:int,total_sales:decimal(27,2)>
-- !query output
1000	10992.09
299	12649.43
358	5955.66
385	12992.19
402	10322.05
423	6878.60
430	9891.62
432	8779.74
445	9913.18
464	641.96
472	6060.92
476	8166.70
493	11859.91
529	6476.80
564	3210.59
567	9226.08
590	13381.82
607	5770.19
623	12388.39
651	11129.87
655	11632.71
658	10926.50
668	5666.30
678	9976.96
682	1074.64
692	2773.42
696	7732.80
697	959.48
698	214.34
704	3574.75
705	10202.62
709	7247.76
710	7783.45
718	13768.98
723	12068.58
733	10653.42
737	4284.65
738	2945.77
741	1195.96
766	6237.09
770	3379.72
772	7196.00
773	9431.83
774	5138.38
780	7973.56
783	6341.40
784	7894.58
789	10376.28
793	6871.33
794	6474.90
795	6859.76
797	3485.44
798	5017.15
799	6360.64
806	7143.83
810	12598.51
811	6887.18
812	2069.00
821	3446.02
824	6198.72
826	12657.78
828	8398.05
832	2684.32
838	2256.80
839	8299.55
842	8879.82
844	11348.42
849	5099.82
853	3850.44
860	5957.46
870	12927.40
872	8722.84
874	12585.39
880	7202.52
887	6998.14
898	3854.56
899	2355.04
910	2291.67
920	10922.38
928	6536.81
929	539.60
936	10760.28
937	3968.27
938	858.22
939	5122.92
942	4618.19
946	6817.54
947	5138.04
951	5973.81
954	11383.41
961	7098.23
963	2380.92
965	11158.41
966	8715.08
968	8461.36
974	3527.17
977	10067.34
981	8899.15
99	11785.13
990	2370.68
