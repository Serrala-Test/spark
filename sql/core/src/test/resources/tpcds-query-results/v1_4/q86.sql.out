-- Automatically generated by TPCDSQueryTestSuite

-- !query
SELECT
  sum(ws_net_paid) AS total_sum,
  i_category,
  i_class,
  grouping(i_category) + grouping(i_class) AS lochierarchy,
  rank()
  OVER (
    PARTITION BY grouping(i_category) + grouping(i_class),
      CASE WHEN grouping(i_class) = 0
        THEN i_category END
    ORDER BY sum(ws_net_paid) DESC) AS rank_within_parent
FROM
  web_sales, date_dim d1, item
WHERE
  d1.d_month_seq BETWEEN 1200 AND 1200 + 11
    AND d1.d_date_sk = ws_sold_date_sk
    AND i_item_sk = ws_item_sk
GROUP BY ROLLUP (i_category, i_class)
ORDER BY
  lochierarchy DESC,
  CASE WHEN lochierarchy = 0
    THEN i_category END,
  rank_within_parent
LIMIT 100
-- !query schema
struct<total_sum:decimal(17,2),i_category:string,i_class:string,lochierarchy:tinyint,rank_within_parent:int>
-- !query output
1453516.79	Books                                             	arts                                              	0	16
1457032.40	Jewelry                                           	consignment                                       	0	16
1457642.85	Home                                              	wallpaper                                         	0	16
1503088.13	Home                                              	rugs                                              	0	15
1512375.29	Electronics                                       	audio                                             	0	16
15602.52	NULL	semi-precious                                     	0	14
1570699.11	Home                                              	accent                                            	0	14
1625306.26	Jewelry                                           	bracelets                                         	0	15
1636759.38	Jewelry                                           	semi-precious                                     	0	14
1641874.01	Books                                             	cooking                                           	0	15
1670511.23	Electronics                                       	camcorders                                        	0	15
1698653.10	Books                                             	entertainments                                    	0	14
1730490.24	Electronics                                       	personal                                          	0	14
1733994.95	Electronics                                       	musical                                           	0	13
1738088.37	Jewelry                                           	diamonds                                          	0	13
1768939.49	Electronics                                       	cameras                                           	0	12
1788142.30	Home                                              	blinds/shades                                     	0	13
1793728.96	Electronics                                       	portable                                          	0	11
1805905.27	Home                                              	kids                                              	0	12
1811297.48	Jewelry                                           	loose stones                                      	0	12
1816997.04	Home                                              	decor                                             	0	11
1817324.19	Books                                             	mystery                                           	0	13
1819360.79	Books                                             	self-help                                         	0	12
1820456.21	Jewelry                                           	earings                                           	0	11
1820604.22	Home                                              	furniture                                         	0	10
1838653.07	Electronics                                       	automotive                                        	0	10
1838748.38	Jewelry                                           	birdal                                            	0	10
1868688.89	Home                                              	tables                                            	0	9
1894729.95	Electronics                                       	disk drives                                       	0	9
1903280.30	Books                                             	sports                                            	0	11
1904474.64	Books                                             	business                                          	0	10
1916049.65	Books                                             	science                                           	0	9
1924834.23	Home                                              	mattresses                                        	0	8
1938302.12	Books                                             	parenting                                         	0	8
1948029.88	Electronics                                       	wireless                                          	0	8
1964085.08	Jewelry                                           	costume                                           	0	9
2023862.05	Books                                             	travel                                            	0	7
2057556.93	Jewelry                                           	mens watch                                        	0	8
2085612.39	Home                                              	bathroom                                          	0	7
2105536.74	Jewelry                                           	womens watch                                      	0	7
2105589.88	Jewelry                                           	estate                                            	0	6
2112112.73	Home                                              	lighting                                          	0	6
21122.88	NULL	tennis                                            	0	13
2132619.93	Books                                             	reference                                         	0	6
2141484.71	Jewelry                                           	gold                                              	0	5
2216602.19	Jewelry                                           	custom                                            	0	4
2220829.36	Books                                             	home repair                                       	0	5
2228844.29	Electronics                                       	scanners                                          	0	7
2235218.27	Electronics                                       	monitors                                          	0	6
2257811.83	Electronics                                       	karoke                                            	0	5
2262599.89	Electronics                                       	stereo                                            	0	4
2269734.86	Home                                              	glassware                                         	0	5
2283231.32	Electronics                                       	memory                                            	0	3
2284168.74	Home                                              	flatware                                          	0	4
2306676.63	Home                                              	bedding                                           	0	3
2308524.13	Jewelry                                           	rings                                             	0	3
2346470.04	Jewelry                                           	pendants                                          	0	2
2349779.93	Home                                              	curtains/drapes                                   	0	2
2351244.66	Electronics                                       	televisions                                       	0	2
2359621.74	Books                                             	fiction                                           	0	4
2408305.34	Home                                              	paint                                             	0	1
2513406.90	Books                                             	computers                                         	0	3
2533681.90	Books                                             	romance                                           	0	2
25714.74	NULL	sports-apparel                                    	0	12
25780.80	NULL	pants                                             	0	11
2625503.90	Electronics                                       	dvd/vcr players                                   	0	1
2754963.88	Jewelry                                           	jewelry boxes                                     	0	1
2981755.34	Books                                             	history                                           	0	1
29969.36	NULL	dresses                                           	0	10
30361.13	NULL	outdoor                                           	0	9
31428816.29	Home                                              	NULL	1	10
31877378.15	Children                                          	NULL	1	9
31908139.65	Sports                                            	NULL	1	8
32027085.12	Jewelry                                           	NULL	1	7
32135907.22	Electronics                                       	NULL	1	6
32159.86	NULL	archery                                           	0	8
32233369.67	Men                                               	NULL	1	5
325552630.64	NULL	NULL	2	1
32942681.04	Books                                             	NULL	1	4
33061835.62	Women                                             	NULL	1	3
33399717.80	Music                                             	NULL	1	2
33602545.41	Shoes                                             	NULL	1	1
33866.09	NULL	scanners                                          	0	7
34642.53	NULL	swimwear                                          	0	6
36841.11	NULL	baseball                                          	0	5
40345.26	NULL	flatware                                          	0	4
43184.49	NULL	glassware                                         	0	3
45178.92	Children                                          	NULL	0	5
476839.60	NULL	NULL	0	1
55823.63	Home                                              	NULL	0	17
7529560.01	Children                                          	newborn                                           	0	4
7716135.48	Children                                          	school-uniforms                                   	0	3
7982811.62	Children                                          	toddlers                                          	0	2
8079270.31	Men                                               	sports-apparel                                    	0	2
84068.23	Books                                             	NULL	0	17
8603692.12	Children                                          	infants                                           	0	1
88724.30	NULL	womens                                            	0	2
8968117.21	Men                                               	shirts                                            	0	1
935154.67	NULL	NULL	1	11
98583.06	Jewelry                                           	NULL	0	17
