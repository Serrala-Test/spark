-- Automatically generated by TPCDSQueryTestSuite

-- !query
WITH year_total AS (
  SELECT
    c_customer_id customer_id,
    c_first_name customer_first_name,
    c_last_name customer_last_name,
    c_preferred_cust_flag customer_preferred_cust_flag,
    c_birth_country customer_birth_country,
    c_login customer_login,
    c_email_address customer_email_address,
    d_year dyear,
    sum(ss_ext_list_price - ss_ext_discount_amt) year_total,
    's' sale_type
  FROM customer, store_sales, date_dim
  WHERE c_customer_sk = ss_customer_sk
    AND ss_sold_date_sk = d_date_sk
  GROUP BY c_customer_id
    , c_first_name
    , c_last_name
    , d_year
    , c_preferred_cust_flag
    , c_birth_country
    , c_login
    , c_email_address
    , d_year
  UNION ALL
  SELECT
    c_customer_id customer_id,
    c_first_name customer_first_name,
    c_last_name customer_last_name,
    c_preferred_cust_flag customer_preferred_cust_flag,
    c_birth_country customer_birth_country,
    c_login customer_login,
    c_email_address customer_email_address,
    d_year dyear,
    sum(ws_ext_list_price - ws_ext_discount_amt) year_total,
    'w' sale_type
  FROM customer, web_sales, date_dim
  WHERE c_customer_sk = ws_bill_customer_sk
    AND ws_sold_date_sk = d_date_sk
  GROUP BY
    c_customer_id, c_first_name, c_last_name, c_preferred_cust_flag, c_birth_country,
    c_login, c_email_address, d_year)
SELECT
  -- select list of q11 in TPCDS v1.4 is below:
  -- t_s_secyear.customer_preferred_cust_flag
  t_s_secyear.customer_id,
  t_s_secyear.customer_first_name,
  t_s_secyear.customer_last_name,
  t_s_secyear.customer_email_address
FROM year_total t_s_firstyear
  , year_total t_s_secyear
  , year_total t_w_firstyear
  , year_total t_w_secyear
WHERE t_s_secyear.customer_id = t_s_firstyear.customer_id
  AND t_s_firstyear.customer_id = t_w_secyear.customer_id
  AND t_s_firstyear.customer_id = t_w_firstyear.customer_id
  AND t_s_firstyear.sale_type = 's'
  AND t_w_firstyear.sale_type = 'w'
  AND t_s_secyear.sale_type = 's'
  AND t_w_secyear.sale_type = 'w'
  AND t_s_firstyear.dyear = 2001
  AND t_s_secyear.dyear = 2001 + 1
  AND t_w_firstyear.dyear = 2001
  AND t_w_secyear.dyear = 2001 + 1
  AND t_s_firstyear.year_total > 0
  AND t_w_firstyear.year_total > 0
  AND CASE WHEN t_w_firstyear.year_total > 0
  THEN t_w_secyear.year_total / t_w_firstyear.year_total
  -- q11 in TPCDS v1.4 used NULL
  --     ELSE NULL END
      ELSE 0.0 END
  > CASE WHEN t_s_firstyear.year_total > 0
  THEN t_s_secyear.year_total / t_s_firstyear.year_total
  -- q11 in TPCDS v1.4 used NULL
  --   ELSE NULL END
    ELSE 0.0 END
ORDER BY
  -- order-by list of q11 in TPCDS v1.4 is below:
  -- t_s_secyear.customer_preferred_cust_flag
  t_s_secyear.customer_id,
  t_s_secyear.customer_first_name,
  t_s_secyear.customer_last_name,
  t_s_secyear.customer_email_address
LIMIT 100
-- !query schema
struct<customer_id:string,customer_first_name:string,customer_last_name:string,customer_email_address:string>
-- !query output
AAAAAAAAAFGBBAAA	Howard	Major	Howard.Major@vTgpJKpgAR5.com
AAAAAAAAAMGDAAAA	Kenneth	Harlan	Kenneth.Harlan@HlOPitjATDz.com
AAAAAAAAAOPFBAAA	Jerry	Fields	Jerry.Fields@Ojv.com
AAAAAAAABLEIBAAA	Paula	Wakefield	Paula.Wakefield@MguENzr.org
AAAAAAAABNBBAAAA	Irma	Smith	Irma.Smith@dOdDOArM.com
AAAAAAAACADPAAAA	Cristobal	Thomas	Cristobal.Thomas@BBZ8YzJtV.com
AAAAAAAACFENAAAA	Christopher	Dawson	Christopher.Dawson@zVq3.com
AAAAAAAACIJMAAAA	Elizabeth	Thomas	Elizabeth.Thomas@KSvEGUaQLXJ1or.com
AAAAAAAACJDIAAAA	James	Kerr	James.Kerr@I0YNJEK.com
AAAAAAAACNAGBAAA	Virginia	May	Virginia.May@PLU.com
AAAAAAAADBEFBAAA	Bennie	Bowers	Bennie.Bowers@nTZlFc.edu
AAAAAAAADCKOAAAA	Robert	Gonzalez	Robert.Gonzalez@to4p9b0r8G.org
AAAAAAAADFKABAAA	Latoya	Craft	Latoya.Craft@qalmJEPUj8atNAig9.com
AAAAAAAADIIOAAAA	David	Carroll	David.Carroll@fm.edu
AAAAAAAADIJGBAAA	Ruth	Sanders	Ruth.Sanders@NCUgETGA.edu
AAAAAAAADLHBBAAA	Henry	Bertrand	Henry.Bertrand@Id05NtU7iLc.edu
AAAAAAAAEADJAAAA	Ruth	Carroll	Ruth.Carroll@EohtbmzyF.com
AAAAAAAAEJDLAAAA	Alice	Wright	Alice.Wright@4Gmyzrc8Gm8Kb.edu
AAAAAAAAEKFPAAAA	Annika	Chin	Annika.Chin@FVgxzyo.org
AAAAAAAAEKJLAAAA	Aisha	Carlson	Aisha.Carlson@bjByl9B.com
AAAAAAAAEPOGAAAA	Felisha	Mendes	Felisha.Mendes@AlUFyamzf2Od.org
AAAAAAAAFACEAAAA	Priscilla	Miller	Priscilla.Miller@kbGFOyfTqA.com
AAAAAAAAFBAHAAAA	Michael	Williams	Michael.Williams@P4JKNczg4oMm3H.com
AAAAAAAAFGIGAAAA	Eduardo	Miller	Eduardo.Miller@UaBKxI.edu
AAAAAAAAFGPGAAAA	Albert	Wadsworth	Albert.Wadsworth@peud.com
AAAAAAAAFMHIAAAA	Emilio	Darling	Emilio.Darling@RxnIgIv4Z.org
AAAAAAAAFOGIAAAA	Michelle	Greene	Michelle.Greene@yQ979J.org
AAAAAAAAFOJAAAAA	Don	Castillo	Don.Castillo@egdlkdkmDCPDSI.com
AAAAAAAAGEHIAAAA	Tyler	Miller	Tyler.Miller@Pob9A0alrhbd.com
AAAAAAAAGHPBBAAA	Nick	Mendez	Nick.Mendez@Zi12qOuB.edu
AAAAAAAAGNDAAAAA	Terry	Mcdowell	Terry.Mcdowell@q0MspRrmB74klnp2zlo.com
AAAAAAAAHGOABAAA	Sonia	White	Sonia.White@OU4q7.com
AAAAAAAAHHCABAAA	William	Stewart	William.Stewart@AFtNRKMOeX8mtY.com
AAAAAAAAHJLAAAAA	Audrey	Beltran	Audrey.Beltran@ZIx7Kk5A4D0vl3O5uH.edu
AAAAAAAAHMJNAAAA	Ryan	Baptiste	Ryan.Baptiste@tSsPxdJl.com
AAAAAAAAHMOIAAAA	Grace	Henderson	Grace.Henderson@j2ZRciZ.com
AAAAAAAAIADEBAAA	Diane	Aldridge	Diane.Aldridge@opDqHMJfIPxL4q.org
AAAAAAAAIBAEBAAA	Sandra	Wilson	Sandra.Wilson@dvtemZk.com
AAAAAAAAIBFCBAAA	Ruth	Grantham	Ruth.Grantham@4zX7OimYePBI.com
AAAAAAAAIBHHAAAA	Jennifer	Ballard	Jennifer.Ballard@PNXHeBILEMUsdvig5qp.com
AAAAAAAAICHFAAAA	Linda	Mccoy	Linda.Mccoy@2.org
AAAAAAAAIDKFAAAA	Michael	Mack	Michael.Mack@F1fvuuX.org
AAAAAAAAIJEMAAAA	Charlie	Cummings	Charlie.Cummings@f72nHGS91b.edu
AAAAAAAAIMHBAAAA	Kathy	Knowles	Kathy.Knowles@7O.edu
AAAAAAAAIMHHBAAA	Lillian	Davidson	Lillian.Davidson@nX5L7Fxx.com
AAAAAAAAJDBLAAAA	Melvin	Taylor	Melvin.Taylor@Sh6OF9kvEuzUot2h.org
AAAAAAAAJEKFBAAA	Norma	Burkholder	Norma.Burkholder@RnffoFOO3JqrByZ.com
AAAAAAAAJGMMAAAA	Richard	Larson	Richard.Larson@jlrb5u4shXJB.com
AAAAAAAAJIALAAAA	Santos	Gutierrez	Santos.Gutierrez@abGvPaGVZhTn.org
AAAAAAAAJKBNAAAA	Julie	Kern	Julie.Kern@2XoKSkOnOlsBi.com
AAAAAAAAJMHLAAAA	Wanda	Ryan	Wanda.Ryan@vOsFQG.com
AAAAAAAAJONHBAAA	Warren	Orozco	Warren.Orozco@ekmruXzGXd.edu
AAAAAAAAJPINAAAA	Rose	Waite	Rose.Waite@MiF3NmdGMteiB6U.org
AAAAAAAAKAECAAAA	Milton	Mackey	Milton.Mackey@QOPtZd.org
AAAAAAAAKAPPAAAA	Karen	Parker	Karen.Parker@4Oogc.org
AAAAAAAAKJBKAAAA	Georgia	Scott	Georgia.Scott@cxmGbxayd.edu
AAAAAAAAKJBLAAAA	Kerry	Davis	Kerry.Davis@i.com
AAAAAAAAKKGEAAAA	Katie	Dunbar	Katie.Dunbar@G.org
AAAAAAAAKLHHBAAA	Manuel	Castaneda	Manuel.Castaneda@dyb27z0O.org
AAAAAAAAKNAKAAAA	Gladys	Banks	Gladys.Banks@4hbFI.org
AAAAAAAALFKKAAAA	Ignacio	Miller	Ignacio.Miller@oJHPfFNn.com
AAAAAAAALHMCAAAA	Brooke	Nelson	Brooke.Nelson@V7.com
AAAAAAAALIOPAAAA	Derek	Allen	Derek.Allen@72Fi2eeluJ6a.org
AAAAAAAALJNCBAAA	George	Gamez	George.Gamez@KTKayzrvPmMZg.org
AAAAAAAAMDCAAAAA	Louann	Hamel	Louann.Hamel@cryopHM6lqau9u.com
AAAAAAAAMFFLAAAA	Margret	Gray	Margret.Gray@eP.edu
AAAAAAAAMMOBBAAA	Margaret	Smith	Margaret.Smith@Bt.edu
AAAAAAAANFBDBAAA	Vernice	Fernandez	Vernice.Fernandez@gi3Kz7RzOr1.edu
AAAAAAAANGDBBAAA	Carlos	Jewell	Carlos.Jewell@jh2ezKNI7nu3.com
AAAAAAAANIPLAAAA	Eric	Lawrence	Eric.Lawrence@K3cGeN3t2Y.com
AAAAAAAANJAGAAAA	Allen	Hood	Allen.Hood@kPEJVolYJb.edu
AAAAAAAANJHCBAAA	Christopher	Schreiber	Christopher.Schreiber@e5tzM5kG0vPBp.org
AAAAAAAANJOLAAAA	Debra	Underwood	Debra.Underwood@f3193uX.org
AAAAAAAAOBADBAAA	Elizabeth	Burnham	Elizabeth.Burnham@EDSfBapF0jU1.org
AAAAAAAAOCAJAAAA	Jenna	Staton	Jenna.Staton@xvQ0ZJy9K.org
AAAAAAAAOCLBBAAA	NULL	NULL	Andrew.Buckley@FcFn.org
AAAAAAAAODMMAAAA	Gayla	Cline	Gayla.Cline@FEFgYu4rtc.com
AAAAAAAAOFLCAAAA	James	Taylor	James.Taylor@BCRCbil3dIgO.com
AAAAAAAAOPDLAAAA	Ann	Pence	Ann.Pence@NnFib4HYa89ouq7CRC.org
AAAAAAAAPDFBAAAA	Terrance	Banks	Terrance.Banks@937P2ZH0g.edu
AAAAAAAAPEHEBAAA	Edith	Molina	Edith.Molina@q9CS0P.com
AAAAAAAAPFCLAAAA	Felicia	Neville	Felicia.Neville@ZQCM0Ctmt60s9MDa.edu
AAAAAAAAPICEAAAA	Jennifer	Cortez	Jennifer.Cortez@13Qh.com
AAAAAAAAPJENAAAA	Ashley	Norton	Ashley.Norton@s.edu
AAAAAAAAPKBCBAAA	Andrea	White	Andrea.White@5JE.org
AAAAAAAAPKIKAAAA	Wendy	Horvath	Wendy.Horvath@eD2YgVGsedc.com
AAAAAAAAPMMBBAAA	Paul	Jordan	Paul.Jordan@bTeytMqxhScdL.org
AAAAAAAAPPIBBAAA	Candice	Lee	Candice.Lee@49mNiRXFM5ZuXadL.org
