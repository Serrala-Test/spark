-- Automatically generated by TPCDSQueryTestSuite

-- !query
-- This is a new query in TPCDS v2.7
with results as (
    select
        i_category,
        i_class,
        i_brand,
        i_product_name,
        d_year,
        d_qoy,
        d_moy,
        s_store_id,
        sum(coalesce(ss_sales_price * ss_quantity, 0)) sumsales
    from
      store_sales, date_dim, store, item
    where
      ss_sold_date_sk=d_date_sk
        and ss_item_sk=i_item_sk
        and ss_store_sk = s_store_sk
        and d_month_seq between 1212 and 1212 + 11
    group by
      i_category,
      i_class,
      i_brand,
      i_product_name,
      d_year,
      d_qoy,
      d_moy,
      s_store_id),
results_rollup as (
    select
      i_category,
      i_class,
      i_brand,
      i_product_name,
      d_year,
      d_qoy,
      d_moy,
      s_store_id,
      sumsales
    from
      results
    union all
    select
      i_category,
      i_class,
      i_brand,
      i_product_name,
      d_year,
      d_qoy,
      d_moy,
      null s_store_id,
      sum(sumsales) sumsales
    from
      results
    group by
      i_category,
      i_class,
      i_brand,
      i_product_name,
      d_year,
      d_qoy,
      d_moy
    union all
    select
      i_category,
      i_class,
      i_brand,
      i_product_name,
      d_year,
      d_qoy,
      null d_moy,
      null s_store_id,
      sum(sumsales) sumsales
    from
      results
    group by
      i_category,
      i_class,
      i_brand,
      i_product_name,
      d_year,
      d_qoy
    union all
    select
      i_category,
      i_class,
      i_brand,
      i_product_name,
      d_year,
      null d_qoy,
      null d_moy,
      null s_store_id,
      sum(sumsales) sumsales
    from
      results
    group by
      i_category,
      i_class,
      i_brand,
      i_product_name,
      d_year
    union all
    select
      i_category,
      i_class,
      i_brand,
      i_product_name,
      null d_year,
      null d_qoy,
      null d_moy,
      null s_store_id,
      sum(sumsales) sumsales
  from
    results
  group by
    i_category,
    i_class,
    i_brand,
    i_product_name
  union all
  select
    i_category,
    i_class,
    i_brand,
    null i_product_name,
    null d_year,
    null d_qoy,
    null d_moy,
    null s_store_id,
    sum(sumsales) sumsales
  from
    results
  group by
    i_category,
    i_class,
    i_brand
  union all
  select
    i_category,
    i_class,
    null i_brand,
    null i_product_name,
    null d_year,
    null d_qoy,
    null d_moy,
    null s_store_id,
    sum(sumsales) sumsales
  from
    results
  group by
    i_category,
    i_class
  union all
  select
    i_category,
    null i_class,
    null i_brand,
    null i_product_name,
    null d_year,
    null d_qoy,
    null d_moy,
    null s_store_id,
    sum(sumsales) sumsales
  from results
  group by
    i_category
  union all
  select
    null i_category,
    null i_class,
    null i_brand,
    null i_product_name,
    null d_year,
    null d_qoy,
    null d_moy,
    null s_store_id,
    sum(sumsales) sumsales
  from
    results)
select
  *
from (
    select
      i_category,
      i_class,
      i_brand,
      i_product_name,
      d_year,
      d_qoy,
      d_moy,
      s_store_id,
      sumsales,
      rank() over (partition by i_category order by sumsales desc) rk
    from results_rollup) dw2
where
  rk <= 100
order by
  i_category,
  i_class,
  i_brand,
  i_product_name,
  d_year,
  d_qoy,
  d_moy,
  s_store_id,
  sumsales,
  rk
limit 100
-- !query schema
struct<i_category:string,i_class:string,i_brand:string,i_product_name:string,d_year:int,d_qoy:int,d_moy:int,s_store_id:string,sumsales:decimal(38,2),rk:int>
-- !query output
NULL	NULL	NULL	NULL	2001	1	NULL	NULL	34479.00	96
NULL	NULL	NULL	NULL	2001	3	9	NULL	56374.56	75
NULL	NULL	NULL	NULL	2001	3	NULL	NULL	84237.95	65
NULL	NULL	NULL	NULL	2001	4	12	NULL	37899.23	92
NULL	NULL	NULL	NULL	2001	4	NULL	NULL	73696.60	69
NULL	NULL	NULL	NULL	2001	NULL	NULL	NULL	213030.29	5
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	1001298828.04	1
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	213030.29	5
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	2171549.36	2
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	497449.55	4
NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	946101.86	3
NULL	NULL	NULL	antiationeinganti                                 	2001	2	NULL	NULL	33639.03	99
NULL	NULL	NULL	antiationeinganti                                 	2001	3	NULL	NULL	33770.94	98
NULL	NULL	NULL	antiationeinganti                                 	2001	4	12	NULL	45444.79	84
NULL	NULL	NULL	antiationeinganti                                 	2001	4	NULL	NULL	86377.39	64
NULL	NULL	NULL	antiationeinganti                                 	2001	NULL	NULL	NULL	177219.10	7
NULL	NULL	NULL	antiationeinganti                                 	NULL	NULL	NULL	NULL	177219.10	7
NULL	NULL	NULL	ationoughtn stpriought                            	2001	4	10	NULL	33340.75	100
NULL	NULL	NULL	ationoughtn stpriought                            	2001	4	NULL	NULL	67776.47	70
NULL	NULL	NULL	ationoughtn stpriought                            	2001	NULL	NULL	NULL	107200.16	42
NULL	NULL	NULL	ationoughtn stpriought                            	NULL	NULL	NULL	NULL	107200.16	42
NULL	NULL	brandmaxi #x                                      	NULL	NULL	NULL	NULL	NULL	112097.69	39
NULL	NULL	brandmaxi #x                                      	oughteingought                                    	2001	4	NULL	NULL	43951.85	86
NULL	NULL	brandmaxi #x                                      	oughteingought                                    	2001	NULL	NULL	NULL	112097.69	39
NULL	NULL	brandmaxi #x                                      	oughteingought                                    	NULL	NULL	NULL	NULL	112097.69	39
NULL	NULL	edu packamalg #x                                  	NULL	NULL	NULL	NULL	NULL	81428.06	66
NULL	NULL	edu packamalg #x                                  	oughtn stn stese                                  	2001	4	NULL	NULL	35042.77	94
NULL	NULL	edu packamalg #x                                  	oughtn stn stese                                  	2001	NULL	NULL	NULL	81428.06	66
NULL	NULL	edu packamalg #x                                  	oughtn stn stese                                  	NULL	NULL	NULL	NULL	81428.06	66
NULL	NULL	exportiedu pack #x                                	NULL	2001	4	NULL	NULL	51178.62	81
NULL	NULL	exportiedu pack #x                                	NULL	2001	NULL	NULL	NULL	116528.07	28
NULL	NULL	exportiedu pack #x                                	NULL	NULL	NULL	NULL	NULL	116528.07	28
NULL	NULL	exportiedu pack #x                                	NULL	NULL	NULL	NULL	NULL	116528.07	28
NULL	NULL	exportischolar #x                                 	NULL	NULL	NULL	NULL	NULL	138598.49	9
NULL	NULL	exportischolar #x                                 	prieingeseought                                   	2001	3	9	NULL	34850.11	95
NULL	NULL	exportischolar #x                                 	prieingeseought                                   	2001	3	NULL	NULL	51880.06	78
NULL	NULL	exportischolar #x                                 	prieingeseought                                   	2001	4	NULL	NULL	51807.30	79
NULL	NULL	exportischolar #x                                 	prieingeseought                                   	2001	NULL	NULL	NULL	138598.49	9
NULL	NULL	exportischolar #x                                 	prieingeseought                                   	NULL	NULL	NULL	NULL	138598.49	9
NULL	archery                                           	NULL	NULL	NULL	NULL	NULL	NULL	126538.57	16
NULL	archery                                           	amalgmaxi #x                                      	NULL	NULL	NULL	NULL	NULL	126538.57	16
NULL	archery                                           	amalgmaxi #x                                      	antioughtn stought                                	2001	4	NULL	NULL	66377.95	72
NULL	archery                                           	amalgmaxi #x                                      	antioughtn stought                                	2001	NULL	NULL	NULL	126538.57	16
NULL	archery                                           	amalgmaxi #x                                      	antioughtn stought                                	NULL	NULL	NULL	NULL	126538.57	16
NULL	camcorders                                        	NULL	NULL	2001	3	NULL	NULL	54123.96	76
NULL	camcorders                                        	NULL	NULL	2001	4	NULL	NULL	44320.28	85
NULL	camcorders                                        	NULL	NULL	2001	NULL	NULL	NULL	133625.83	12
NULL	camcorders                                        	NULL	NULL	NULL	NULL	NULL	NULL	133625.83	12
NULL	camcorders                                        	NULL	NULL	NULL	NULL	NULL	NULL	133625.83	12
NULL	camcorders                                        	NULL	NULL	NULL	NULL	NULL	NULL	133625.83	12
NULL	dresses                                           	NULL	NULL	NULL	NULL	NULL	NULL	115317.62	31
NULL	dresses                                           	NULL	NULL	NULL	NULL	NULL	NULL	115317.62	31
NULL	dresses                                           	NULL	antieseoughtcally                                 	2001	4	NULL	NULL	53621.08	77
NULL	dresses                                           	NULL	antieseoughtcally                                 	2001	NULL	NULL	NULL	115317.62	31
NULL	dresses                                           	NULL	antieseoughtcally                                 	NULL	NULL	NULL	NULL	115317.62	31
NULL	flatware                                          	NULL	NULL	NULL	NULL	NULL	NULL	96861.65	56
NULL	flatware                                          	NULL	NULL	NULL	NULL	NULL	NULL	96861.65	56
NULL	flatware                                          	NULL	oughteingationn st                                	2001	3	NULL	NULL	34255.55	97
NULL	flatware                                          	NULL	oughteingationn st                                	2001	4	NULL	NULL	42069.01	88
NULL	flatware                                          	NULL	oughteingationn st                                	2001	NULL	NULL	NULL	96861.65	56
NULL	flatware                                          	NULL	oughteingationn st                                	NULL	NULL	NULL	NULL	96861.65	56
NULL	glassware                                         	NULL	NULL	2001	4	NULL	NULL	51575.84	80
NULL	glassware                                         	NULL	NULL	2001	NULL	NULL	NULL	106618.97	44
NULL	glassware                                         	NULL	NULL	NULL	NULL	NULL	NULL	106618.97	44
NULL	glassware                                         	NULL	NULL	NULL	NULL	NULL	NULL	106618.97	44
NULL	glassware                                         	NULL	NULL	NULL	NULL	NULL	NULL	106618.97	44
NULL	pants                                             	NULL	NULL	NULL	NULL	NULL	NULL	93894.90	60
NULL	pants                                             	exportiimporto #x                                 	NULL	NULL	NULL	NULL	NULL	93894.90	60
NULL	pants                                             	exportiimporto #x                                 	antibarableableought                              	2001	3	8	NULL	38046.99	91
NULL	pants                                             	exportiimporto #x                                 	antibarableableought                              	2001	3	NULL	NULL	48275.60	82
NULL	pants                                             	exportiimporto #x                                 	antibarableableought                              	2001	NULL	NULL	NULL	93894.90	60
NULL	pants                                             	exportiimporto #x                                 	antibarableableought                              	NULL	NULL	NULL	NULL	93894.90	60
NULL	scanners                                          	NULL	NULL	NULL	NULL	NULL	NULL	97564.12	52
NULL	scanners                                          	namelessunivamalg #x                             	NULL	NULL	NULL	NULL	NULL	97564.12	52
NULL	scanners                                          	namelessunivamalg #x                             	n stbaresepri                                     	2001	4	NULL	NULL	43503.76	87
NULL	scanners                                          	namelessunivamalg #x                             	n stbaresepri                                     	2001	NULL	NULL	NULL	97564.12	52
NULL	scanners                                          	namelessunivamalg #x                             	n stbaresepri                                     	NULL	NULL	NULL	NULL	97564.12	52
NULL	semi-precious                                     	NULL	NULL	NULL	NULL	NULL	NULL	113803.74	35
NULL	semi-precious                                     	amalgbrand #x                                     	NULL	NULL	NULL	NULL	NULL	113803.74	35
NULL	semi-precious                                     	amalgbrand #x                                     	ationeseoughtanti                                 	2001	4	NULL	NULL	62265.30	73
NULL	semi-precious                                     	amalgbrand #x                                     	ationeseoughtanti                                 	2001	NULL	NULL	NULL	113803.74	35
NULL	semi-precious                                     	amalgbrand #x                                     	ationeseoughtanti                                 	NULL	NULL	NULL	NULL	113803.74	35
NULL	sports-apparel                                    	NULL	NULL	2001	4	12	NULL	45659.44	83
NULL	sports-apparel                                    	NULL	NULL	2001	4	NULL	NULL	66745.05	71
NULL	sports-apparel                                    	NULL	NULL	2001	NULL	NULL	NULL	117144.79	24
NULL	sports-apparel                                    	NULL	NULL	NULL	NULL	NULL	NULL	117144.79	24
NULL	sports-apparel                                    	NULL	NULL	NULL	NULL	NULL	NULL	117144.79	24
NULL	sports-apparel                                    	NULL	NULL	NULL	NULL	NULL	NULL	117144.79	24
NULL	swimwear                                          	NULL	NULL	NULL	NULL	NULL	NULL	103045.34	48
NULL	swimwear                                          	edu packamalg #x                                  	NULL	NULL	NULL	NULL	NULL	103045.34	48
NULL	swimwear                                          	edu packamalg #x                                  	antieingoughtcally                                	2001	3	NULL	NULL	36125.25	93
NULL	swimwear                                          	edu packamalg #x                                  	antieingoughtcally                                	2001	4	NULL	NULL	41241.08	89
NULL	swimwear                                          	edu packamalg #x                                  	antieingoughtcally                                	2001	NULL	NULL	NULL	103045.34	48
NULL	swimwear                                          	edu packamalg #x                                  	antieingoughtcally                                	NULL	NULL	NULL	NULL	103045.34	48
NULL	womens                                            	NULL	NULL	NULL	NULL	NULL	NULL	121031.97	20
NULL	womens                                            	amalgedu pack #x                                  	NULL	2001	3	NULL	NULL	38120.58	90
NULL	womens                                            	amalgedu pack #x                                  	NULL	2001	4	NULL	NULL	57168.07	74
NULL	womens                                            	amalgedu pack #x                                  	NULL	2001	NULL	NULL	NULL	121031.97	20
NULL	womens                                            	amalgedu pack #x                                  	NULL	NULL	NULL	NULL	NULL	121031.97	20
NULL	womens                                            	amalgedu pack #x                                  	NULL	NULL	NULL	NULL	NULL	121031.97	20
