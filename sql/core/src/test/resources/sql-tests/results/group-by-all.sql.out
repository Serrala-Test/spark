-- Automatically generated by SQLQueryTestSuite
-- !query
create temporary view data as select * from values
  ("USA", "San Francisco", "Reynold", 1, 11.0),
  ("USA", "San Francisco", "Matei", 2, 12.0),
  ("USA", "Berkeley", "Xiao", 3, 13.0),
  ("China", "Hangzhou", "Wenchen", 4, 14.0),
  ("China", "Shanghai", "Shanghaiese", 5, 15.0),
  ("Korea", "Seoul", "Hyukjin", 6, 16.0)
  as data(country, city, name, id, power)
-- !query schema
struct<>
-- !query output



-- !query
select country, count(*) from data group by ALL
-- !query schema
struct<country:string,count(1):bigint>
-- !query output
China	2
Korea	1
USA	3


-- !query
select country, count(*) from data group by aLl
-- !query schema
struct<country:string,count(1):bigint>
-- !query output
China	2
Korea	1
USA	3


-- !query
select country, city, count(*), sum(power) from data group by all
-- !query schema
struct<country:string,city:string,count(1):bigint,sum(power):decimal(13,1)>
-- !query output
China	Hangzhou	1	14.0
China	Shanghai	1	15.0
Korea	Seoul	1	16.0
USA	Berkeley	1	13.0
USA	San Francisco	2	23.0


-- !query
select count(*), country, city, sum(power) from data group by all
-- !query schema
struct<count(1):bigint,country:string,city:string,sum(power):decimal(13,1)>
-- !query output
1	China	Hangzhou	14.0
1	China	Shanghai	15.0
1	Korea	Seoul	16.0
1	USA	Berkeley	13.0
2	USA	San Francisco	23.0


-- !query
select country as con, count(*) from data group by all
-- !query schema
struct<con:string,count(1):bigint>
-- !query output
China	2
Korea	1
USA	3


-- !query
select country, count(*) as cnt from data group by all
-- !query schema
struct<country:string,cnt:bigint>
-- !query output
China	2
Korea	1
USA	3


-- !query
select upper(country), count(*) as powerup from data group by all
-- !query schema
struct<upper(country):string,powerup:bigint>
-- !query output
CHINA	2
KOREA	1
USA	3


-- !query
select country, sum(power) + 10 as powerup from data group by all
-- !query schema
struct<country:string,powerup:decimal(14,1)>
-- !query output
China	39.0
Korea	26.0
USA	46.0


-- !query
select country, city from data group by all
-- !query schema
struct<country:string,city:string>
-- !query output
China	Hangzhou
China	Shanghai
Korea	Seoul
USA	Berkeley
USA	San Francisco


-- !query
select con, powerup from
  (select country as con, sum(power) + 10 as powerup from data group by all)
-- !query schema
struct<con:string,powerup:decimal(14,1)>
-- !query output
China	39.0
Korea	26.0
USA	46.0


-- !query
select country, count(id) as cnt from data group by all having cnt > 1
-- !query schema
struct<country:string,cnt:bigint>
-- !query output
China	2
USA	3


-- !query
select count(id) from data group by all
-- !query schema
struct<count(id):bigint>
-- !query output
6


-- !query
select count(id + power / 2) * 3 from data group by all
-- !query schema
struct<(count((id + (power / 2))) * 3):bigint>
-- !query output
18


-- !query
select count(*) from (select * from data where country = "DNS") group by all
-- !query schema
struct<count(1):bigint>
-- !query output
0


-- !query
select id + count(*) from data group by all
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "UNRESOLVED_ALL_IN_GROUP_BY",
  "sqlState" : "42000",
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 32,
    "stopIndex" : 43,
    "fragment" : "group by all"
  } ]
}


-- !query
select (id + id) / 2 + count(*) * 2 from data group by all
-- !query schema
struct<>
-- !query output
org.apache.spark.sql.AnalysisException
{
  "errorClass" : "UNRESOLVED_ALL_IN_GROUP_BY",
  "sqlState" : "42000",
  "queryContext" : [ {
    "objectType" : "",
    "objectName" : "",
    "startIndex" : 47,
    "stopIndex" : 58,
    "fragment" : "group by all"
  } ]
}
